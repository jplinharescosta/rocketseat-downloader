# Downloader de Cursos da Rocketseat

## Script original em: https://gist.github.com/felipeadeildo/961587b1f5660a5db42102666e9884d0

## Script de atualiza√ß√£o em: https://github.com/Kazbonfim/rocketseat-downloader2

Cr√©ditos para @felipeadeildo e @Kazbonfim

Este √© um script em Python projetado para automatizar o download de cursos, m√≥dulos e materiais da plataforma Rocketseat. Ele utiliza a sess√£o do usu√°rio para acessar o conte√∫do e o `yt-dlp` para baixar as videoaulas de forma eficiente.

## ‚ö†Ô∏è Aviso Legal

Este script foi criado para **fins educacionais** e para facilitar o acesso offline a conte√∫dos que voc√™ **j√° possui legalmente**. O download e a distribui√ß√£o de conte√∫do protegido por direitos autorais sem permiss√£o s√£o ilegais. Use esta ferramenta por sua conta e risco, respeitando sempre os **Termos de Servi√ßo** da Rocketseat.

N√£o endorsamos o compartilhamento indevido de conte√∫dos!

---

## ‚ú® Funcionalidades

- **Autentica√ß√£o Segura**: Realiza login na sua conta e salva a sess√£o localmente para n√£o precisar inserir suas credenciais a cada uso. Suporte a credenciais via vari√°veis de ambiente e senha mascarada no prompt.
- **Verifica√ß√£o de Depend√™ncias**: Checa automaticamente se **FFmpeg** e **yt-dlp** est√£o instalados e acess√≠veis no `PATH` do sistema.
- **Sele√ß√£o Interativa**: Permite escolher interativamente qual forma√ß√£o e quais m√≥dulos espec√≠ficos voc√™ deseja baixar.
- **Organiza√ß√£o Autom√°tica**: Cria uma estrutura de pastas organizada para os cursos baixados: `Cursos/Nome da Forma√ß√£o/Nome do Curso/Nome do M√≥dulo/`.
- **Download Completo**: Baixa os v√≠deos via `yt-dlp` (com headers obrigat√≥rios) e tamb√©m materiais de apoio. Gera um `.txt` com metadados (descri√ß√£o, autor, dura√ß√£o) por aula.
- **Resili√™ncia de Rede**: Requisi√ß√µes HTTP com retries e timeout configur√°vel, reduzindo falhas transit√≥rias.
- **Compat√≠vel com m√∫ltiplas estruturas da API**: Funciona tanto com n√≥s do tipo `cluster` (com `groups`) quanto do tipo `group` (li√ß√µes diretamente em `group.lessons`).
- **Relat√≥rio Detalhado**: Ao final, gera um relat√≥rio (`.txt`) na pasta `relatorios`, informando √™xitos, falhas e dura√ß√£o total.
- **Logs para Debug**: Salva a resposta de `/journey-nodes/{slug}` em `logs/{slug}_cluster_details.json` para inspe√ß√£o quando necess√°rio.

---

## üöÄ Pr√©-requisitos

Antes de executar o script, garanta que voc√™ tem o seguinte instalado e configurado em seu sistema:

1.  **Python 3.x**: [Instale a partir do site oficial](https://www.python.org/downloads/).
2.  **FFmpeg**: Essencial para que o `yt-dlp` possa juntar os segmentos de √°udio e v√≠deo.
    - **Download**: [ffmpeg.org/download.html](https://ffmpeg.org/download.html)
    - **Instru√ß√£o**: Ap√≥s o download, **adicione o caminho da pasta `bin` do FFmpeg √†s suas vari√°veis de ambiente (PATH)**.
3.  **yt-dlp**: A ferramenta principal para o download dos v√≠deos.

    - **Download**: [github.com/yt-dlp/yt-dlp](https://github.com/yt-dlp/yt-dlp)
    - **Instru√ß√£o**: Ap√≥s o download, **adicione o caminho do execut√°vel do yt-dlp √†s suas vari√°veis de ambiente (PATH)**.

4.  (Opcional) Defina vari√°veis de ambiente para facilitar o uso sem prompt (ver abaixo).

---

## üõ†Ô∏è Instala√ß√£o

Com os pr√©-requisitos atendidos, siga os passos abaixo.

1.  **Clone o reposit√≥rio ou baixe o script**:
    Se estiver usando Git, clone o reposit√≥rio. Caso contr√°rio, apenas salve o arquivo `.py` em uma pasta de sua escolha.

2.  **Acesse a pasta do projeto**:
    Abra um terminal (CMD, PowerShell ou outro) e navegue at√© a pasta onde voc√™ salvou o script.

    ```bash
    cd caminho/para/a/pasta
    ```

3.  **Instale as depend√™ncias Python**:
    Execute o comando a seguir para instalar as bibliotecas necess√°rias. √â recomendado criar um ambiente virtual (`venv`) antes.

    ```bash
    pip install -r requirements.txt
    ```

    _Observa√ß√£o: O `m3u8` est√° listado, mas o c√≥digo atual n√£o o utiliza ativamente._

4.  (Opcional) Configure vari√°veis de ambiente (ou use um arquivo .env):

    - `ROCKETSEAT_EMAIL` e `ROCKETSEAT_PASSWORD`: para login sem prompt.
    - `HTTP_TIMEOUT`: timeout padr√£o das requisi√ß√µes (segundos, ex.: `30`).
    - `CDN_DOMAIN`: dom√≠nio da CDN do v√≠deo (fallback padr√£o j√° configurado).
    - `SESSION_DIR`: pasta onde o arquivo `.session.pkl` ser√° salvo (por padr√£o, a raiz do projeto).
    - Vari√°veis do `rclone` para sincroniza√ß√£o/c√≥pia p√≥s-download (detalhes abaixo).

### Usando um arquivo .env

Voc√™ pode criar um arquivo `.env` na raiz do projeto para configurar as vari√°veis sem poluir seu ambiente. Um modelo est√° dispon√≠vel em `.env.example`.

Passos:

1. Copie o modelo:

   ```bash
   cp .env.example .env
   ```

2. Edite o `.env` e preencha o que desejar (voc√™ pode deixar o email/senha em branco para serem solicitados).

Observa√ß√µes:

- O script carrega automaticamente o `.env` usando `python-dotenv` (j√° incluso em `requirements.txt`).
- Vari√°veis j√° definidas no ambiente do sistema t√™m preced√™ncia sobre as do `.env`.

---

## ‚òÅÔ∏è Backup/Sincroniza√ß√£o com Google Drive usando rclone (Opcional)

O projeto pode, opcionalmente, copiar/sincronizar/mover os arquivos baixados para o Google Drive ao final de cada forma√ß√£o, usando o [rclone](https://rclone.org/).

### Instala√ß√£o do rclone

- Site oficial (todas as plataformas): https://rclone.org/install/
- Windows:
    - Baixe o execut√°vel pelo site oficial, ou
    - via Winget: `winget install rclone.rclone`, ou
    - via Chocolatey: `choco install rclone`
- macOS:
    - Homebrew: `brew install rclone`
- Linux:
    - Debian/Ubuntu: `sudo apt-get install rclone`
    - Ou use o script oficial de instala√ß√£o do site

Ap√≥s instalar, verifique se est√° acess√≠vel:

```bash
rclone version
```

### Configurando um remote do Google Drive

No terminal, rode o assistente:

```bash
rclone config
```

Passos t√≠picos (resumo):
- n (novo remote) ‚Üí nome (ex.: `gdrive`)
- Escolha o storage: `drive` (Google Drive)
- Auto config: `y` (abre o navegador para autorizar)
- Escolha a conta do Google ‚Üí permita o acesso
- Finalize e confirme com `q`

Teste o remote:

```bash
rclone ls gdrive:
```

### Usando rclone com este projeto

Configure no `.env` (ou vari√°veis de ambiente):

```bash
# habilitar a rotina p√≥s-forma√ß√£o
RCLONE_SYNC=1
# nome do remote
RCLONE_REMOTE=gdrive
# pasta no drive
RCLONE_DEST=Cursos
# comportamento: copy (n√£o apaga), sync (sincroniza), move (move e apaga origem)
RCLONE_MODE=copy
# escopo: specialization (s√≥ a pasta da forma√ß√£o) ou all (pasta Cursos inteira)
RCLONE_SCOPE=specialization
# flags opcionais
RCLONE_EXTRA_ARGS=--color never
```

Comportamentos importantes:
- `copy`: copia do PC para o Drive, n√£o apaga nada (recomendado para backup).
- `sync`: sincroniza destino com origem (pode remover do destino o que n√£o existir na origem).
- `move`: envia e depois apaga os arquivos da origem. Por padr√£o, tamb√©m remove diret√≥rios vazios (pode desativar com `RCLONE_KEEP_EMPTY_DIRS=1`).
- Progresso: por padr√£o, o script for√ßa `--progress` para feedback em tempo real (desative com `RCLONE_PROGRESS=0`).
- Simula√ß√£o: use `RCLONE_EXTRA_ARGS=--dry-run` para testar sem aplicar mudan√ßas. Retire depois para executar de verdade.

Diagn√≥stico √∫til no console:
- Mostramos o comando completo do rclone, a contagem de arquivos na origem e mensagens em tempo real.
- Se rclone n√£o estiver no PATH, aparece um aviso claro.

---

## ‚ñ∂Ô∏è Como Usar

1.  **Execute o script** a partir do seu terminal:

    ```bash
    python main.py
    ```

2.  **Login (Primeiro Uso)**:

    - O script verificar√° se existe um arquivo de sess√£o (`.session.pkl`).
    - Se n√£o houver, ele solicitar√° seu **e-mail** e a **senha mascarada**. Alternativamente, use `ROCKETSEAT_EMAIL` e `ROCKETSEAT_PASSWORD` para login autom√°tico. Ap√≥s o login, a sess√£o ser√° salva para usos futuros.

3.  **Sele√ß√£o da Forma√ß√£o**:

    - Uma lista das suas forma√ß√µes dispon√≠veis ser√° exibida.
    - Digite o n√∫mero correspondente √† forma√ß√£o que deseja baixar e pressione `Enter`.

4.  **Sele√ß√£o dos M√≥dulos**:

    - Em seguida, o script listar√° todos os m√≥dulos da forma√ß√£o escolhida.
    - Voc√™ pode:
      - Digitar `0` para baixar **todos os m√≥dulos**.
      - Digitar os n√∫meros dos m√≥dulos desejados, separados por v√≠rgula (ex: `1, 3, 5`), para baixar apenas os selecionados.

5.  **Aguarde o Download**:

    - O script iniciar√° o processo, exibindo o progresso no console. Os arquivos ser√£o salvos na pasta `Cursos`.
    - Ao final, um relat√≥rio detalhado ser√° impresso no console e salvo em um arquivo na pasta `relatorios`.

6.  (Opcional) Sincroniza√ß√£o/backup autom√°tico para Google Drive com `rclone`:

    Configure as seguintes vari√°veis no seu `.env` (ou exporte no ambiente):

    - `RCLONE_SYNC=1` para habilitar a sincroniza√ß√£o ao final de cada forma√ß√£o.
    - `RCLONE_REMOTE=gdrive` (ou o nome do seu remote no rclone).
    - `RCLONE_DEST=Cursos` (pasta no drive ‚Äì ser√° `gdrive:Cursos/...`).
    - `RCLONE_MODE=copy` para copiar (n√£o apaga nada), `sync` para sincronizar, `move` para mover e apagar a origem ap√≥s copiar.
    - `RCLONE_SCOPE=specialization` (padr√£o) para copiar apenas a pasta da forma√ß√£o conclu√≠da, ou `all` para copiar a pasta `Cursos` inteira.

    Dicas:

    - Para primeiro teste, voc√™ pode usar `RCLONE_EXTRA_ARGS=--dry-run` (simula√ß√£o), depois remova para executar de verdade.
    - Se preferir n√£o ser perguntado sobre m√≥dulos quando selecionar todas as forma√ß√µes, o script j√° assume ‚Äúbaixar todos os m√≥dulos‚Äù automaticamente nesse caso.

---

## üìÇ Estrutura de Arquivos Gerada

O script criar√° a seguinte estrutura de pastas e arquivos:

```
.
‚îú‚îÄ‚îÄ Cursos/
‚îÇ   ‚îî‚îÄ‚îÄ Nome da Forma√ß√£o/
‚îÇ       ‚îî‚îÄ‚îÄ Nome do Curso/
‚îÇ           ‚îî‚îÄ‚îÄ 01. Nome do M√≥dulo/
‚îÇ               ‚îú‚îÄ‚îÄ 01. Nome do Grupo/
‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ 01. T√≠tulo da Aula.mp4
‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ 01. T√≠tulo da Aula.txt
‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ 01. T√≠tulo da Aula_arquivos/
‚îÇ               ‚îÇ       ‚îî‚îÄ‚îÄ material_de_apoio.pdf
‚îÇ               ‚îî‚îÄ‚îÄ 02. Outro Grupo/
‚îÇ                   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ relatorios/
‚îÇ   ‚îî‚îÄ‚îÄ relatorio_20240913_223000.txt
‚îú‚îÄ‚îÄ .session.pkl
‚îî‚îÄ‚îÄ nome_do_script.py
```

## Jamais compartilhe seu arquivo de sess√£o, .pkl

---

## ‚öôÔ∏è Vari√°veis de Ambiente (Resumo)

- `ROCKETSEAT_EMAIL` / `ROCKETSEAT_PASSWORD`: credenciais para login autom√°tico.
- `HTTP_TIMEOUT`: timeout (em segundos) para todas as requisi√ß√µes HTTP (padr√£o: 30).
- `CDN_DOMAIN`: dom√≠nio da CDN usada nos v√≠deos (ex.: `vz-xxxx.b-cdn.net`).
- `SESSION_DIR`: diret√≥rio para salvar `.session.pkl`.
- `RCLONE_SYNC`: `1|true|yes` para habilitar sync/copy/move p√≥s-forma√ß√£o.
- `RCLONE_REMOTE`: nome do remote no rclone (ex.: `gdrive`).
- `RCLONE_DEST`: pasta no remote (ex.: `Cursos` -> `gdrive:Cursos`).
- `RCLONE_MODE`: `copy` (recomendado), `sync` ou `move`.
- `RCLONE_SCOPE`: `specialization` (pasta da forma√ß√£o) ou `all` (pasta `Cursos`).
- `RCLONE_TRANSFERS`, `RCLONE_CHECKERS`, `RCLONE_CHUNK_SIZE`, `RCLONE_RETRIES`, `RCLONE_LL_RETRIES`, `RCLONE_STATS`, `RCLONE_BWLIMIT`, `RCLONE_EXTRA_ARGS`, `RCLONE_BIN`.

---

## ü™™ Cr√©ditos

- Script original: [@felipeadeildo](https://github.com/felipeadeildo)
- Manuten√ß√£o/atualiza√ß√µes e melhorias: [@Kazbonfim](https://github.com/Kazbonfim)

Obrigado por compartilhar conhecimento e facilitar a vida de quem estuda! üôå

---

## üß∞ Dicas e Solu√ß√£o de Problemas

- "yt-dlp n√£o encontrado": verifique a instala√ß√£o e se o execut√°vel est√° no PATH.
- "ffmpeg n√£o encontrado": instale o FFmpeg e adicione a pasta `bin` ao PATH.
- Erros 401/403 ao baixar materiais: garanta que est√° logado (arquivo `.session.pkl` v√°lido) e que possui acesso ao conte√∫do.
- Se a Rocketseat alterar dom√≠nios de entrega dos v√≠deos, ajuste `CDN_DOMAIN`.
- Para diagn√≥sticos, confira `logs/{slug}_cluster_details.json` e os relat√≥rios em `relatorios/`.
